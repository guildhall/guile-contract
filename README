This is a draft of the ported code
